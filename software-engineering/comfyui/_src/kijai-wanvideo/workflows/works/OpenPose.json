{"id":"a1ac1aed-b0b6-40f0-abff-e7c9a42e53b6","revision":0,"last_node_id":25,"last_link_id":36,"nodes":[{"id":2,"type":"WanVideoModelLoader","pos":[-3335.7451171875,678.7548828125],"size":[330,214],"flags":{},"order":0,"mode":0,"inputs":[{"localized_name":"compile_args","name":"compile_args","shape":7,"type":"WANCOMPILEARGS","link":null},{"localized_name":"block_swap_args","name":"block_swap_args","shape":7,"type":"BLOCKSWAPARGS","link":null},{"localized_name":"lora","name":"lora","shape":7,"type":"WANVIDLORA","link":null},{"localized_name":"vram_management_args","name":"vram_management_args","shape":7,"type":"VRAM_MANAGEMENTARGS","link":null}],"outputs":[{"localized_name":"model","name":"model","type":"WANVIDEOMODEL","links":[1]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"WanVideoModelLoader"},"widgets_values":["Wan2.1-Fun-1.3B-Control.safetensors","fp16","disabled","main_device","sageattn"]},{"id":4,"type":"LoadWanVideoT5TextEncoder","pos":[-3859.399658203125,898.9853515625],"size":[352.79998779296875,130],"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[{"localized_name":"wan_t5_model","name":"wan_t5_model","type":"WANTEXTENCODER","links":[3]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"LoadWanVideoT5TextEncoder"},"widgets_values":["umt5-xxl-enc-fp8_e4m3fn.safetensors","bf16","offload_device","disabled"]},{"id":1,"type":"WanVideoSampler","pos":[-2910.338623046875,962.9034423828125],"size":[317.4000244140625,498],"flags":{},"order":18,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"WANVIDEOMODEL","link":1},{"localized_name":"text_embeds","name":"text_embeds","type":"WANVIDEOTEXTEMBEDS","link":2},{"localized_name":"image_embeds","name":"image_embeds","type":"WANVIDIMAGE_EMBEDS","link":4},{"localized_name":"samples","name":"samples","shape":7,"type":"LATENT","link":null},{"localized_name":"feta_args","name":"feta_args","shape":7,"type":"FETAARGS","link":null},{"localized_name":"context_options","name":"context_options","shape":7,"type":"WANVIDCONTEXT","link":null},{"localized_name":"teacache_args","name":"teacache_args","shape":7,"type":"TEACACHEARGS","link":null},{"localized_name":"flowedit_args","name":"flowedit_args","shape":7,"type":"FLOWEDITARGS","link":null},{"localized_name":"slg_args","name":"slg_args","shape":7,"type":"SLGARGS","link":null},{"localized_name":"loop_args","name":"loop_args","shape":7,"type":"LOOPARGS","link":null},{"localized_name":"experimental_args","name":"experimental_args","shape":7,"type":"EXPERIMENTALARGS","link":null}],"outputs":[{"localized_name":"samples","name":"samples","type":"LATENT","links":[16]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"WanVideoSampler"},"widgets_values":[20,6,5,274009973049514,"randomize",true,"unipc",0,1,false,"comfy"]},{"id":6,"type":"WanVideoVAELoader","pos":[-4664.59912109375,1059.5736083984375],"size":[315,82],"flags":{},"order":2,"mode":0,"inputs":[],"outputs":[{"localized_name":"vae","name":"vae","type":"WANVAE","links":[5,9,17]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"WanVideoVAELoader"},"widgets_values":["Wan2_1_VAE_bf16.safetensors","bf16"]},{"id":10,"type":"Note","pos":[-2905.17578125,773.2554931640625],"size":[309.00189208984375,121.31475067138672],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["- ステップ数が標準で30だが、多すぎる。20以下でも十分な性能が出る。"],"color":"#432","bgcolor":"#653"},{"id":8,"type":"WanVideoControlEmbeds","pos":[-3835.647216796875,1588.54541015625],"size":[315,82],"flags":{},"order":16,"mode":0,"inputs":[{"localized_name":"latents","name":"latents","type":"LATENT","link":8}],"outputs":[{"localized_name":"image_embeds","name":"image_embeds","type":"WANVIDIMAGE_EMBEDS","links":[7]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"WanVideoControlEmbeds"},"widgets_values":[0,1]},{"id":11,"type":"GetImageSizeAndCount","pos":[-3819.523193359375,1762.6519775390625],"size":[277.20001220703125,86],"flags":{},"order":14,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"IMAGE","link":11}],"outputs":[{"localized_name":"image","name":"image","type":"IMAGE","links":null},{"label":"512 width","localized_name":"width","name":"width","type":"INT","links":[12]},{"label":"887 height","localized_name":"height","name":"height","type":"INT","links":[13]},{"label":"81 count","localized_name":"count","name":"count","type":"INT","links":[14]}],"properties":{"cnr_id":"comfyui-kjnodes","ver":"1.0.8","Node name for S&R":"GetImageSizeAndCount"},"widgets_values":[]},{"id":9,"type":"WanVideoEncode","pos":[-4250.3994140625,1617.1268310546875],"size":[315,242],"flags":{},"order":13,"mode":0,"inputs":[{"localized_name":"vae","name":"vae","type":"WANVAE","link":9},{"localized_name":"image","name":"image","type":"IMAGE","link":10},{"localized_name":"mask","name":"mask","shape":7,"type":"MASK","link":null}],"outputs":[{"localized_name":"samples","name":"samples","type":"LATENT","links":[8]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"WanVideoEncode"},"widgets_values":[false,272,272,144,128,0,1]},{"id":16,"type":"WanVideoClipVisionEncode","pos":[-3856.9052734375,1235.1331787109375],"size":[342.5999755859375,262],"flags":{},"order":10,"mode":0,"inputs":[{"localized_name":"clip_vision","name":"clip_vision","type":"CLIP_VISION","link":20},{"localized_name":"image_1","name":"image_1","type":"IMAGE","link":23},{"localized_name":"image_2","name":"image_2","shape":7,"type":"IMAGE","link":null},{"localized_name":"negative_image","name":"negative_image","shape":7,"type":"IMAGE","link":null}],"outputs":[{"localized_name":"image_embeds","name":"image_embeds","type":"WANVIDIMAGE_CLIPEMBEDS","links":[19]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"WanVideoClipVisionEncode"},"widgets_values":[1,1,"center","average",true,0,0.5]},{"id":17,"type":"LoadWanVideoClipTextEncoder","pos":[-4256.26611328125,1233.4373779296875],"size":[327.5999755859375,106],"flags":{},"order":4,"mode":0,"inputs":[],"outputs":[{"localized_name":"wan_clip_vision","name":"wan_clip_vision","type":"CLIP_VISION","links":[20]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"LoadWanVideoClipTextEncoder"},"widgets_values":["open-clip-xlm-roberta-large-vit-huge-14_visual_fp16.safetensors","fp16","offload_device"]},{"id":3,"type":"WanVideoTextEncode","pos":[-3399.810302734375,967.004638671875],"size":[400,200],"flags":{},"order":8,"mode":0,"inputs":[{"localized_name":"t5","name":"t5","type":"WANTEXTENCODER","link":3},{"localized_name":"model_to_offload","name":"model_to_offload","shape":7,"type":"WANVIDEOMODEL","link":null}],"outputs":[{"localized_name":"text_embeds","name":"text_embeds","type":"WANVIDEOTEXTEMBEDS","links":[2]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"WanVideoTextEncode"},"widgets_values":["High qualigh movie","色调艳丽，过曝，静态，细节模糊不清，字幕，风格，作品，画作，画面，静止，整体发灰，最差质量，低质量，JPEG压缩残留，丑陋的，残缺的，多余的手指，画得不好的手部，画得不好的脸部，畸形的，毁容的，形态畸形的肢体，手指融合，静止不动的画面，杂乱的背景，三条腿，背景人很多，倒着走",true]},{"id":18,"type":"Note","pos":[-5012.3857421875,65.6417465209961],"size":[261.2859802246094,145.60650634765625],"flags":{},"order":5,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["- force_rateで変換しておかないと、埋め込みの計上が適切なサイズにならない\n- フレーム数が4n+1?の必要があるらしいので、ここでcapを指定して調整する"],"color":"#432","bgcolor":"#653"},{"id":5,"type":"WanVideoImageToVideoEncode","pos":[-3357.491943359375,1321.8509521484375],"size":[352.79998779296875,326],"flags":{},"order":17,"mode":0,"inputs":[{"localized_name":"vae","name":"vae","type":"WANVAE","link":5},{"localized_name":"clip_embeds","name":"clip_embeds","type":"WANVIDIMAGE_CLIPEMBEDS","link":19},{"localized_name":"start_image","name":"start_image","shape":7,"type":"IMAGE","link":6},{"localized_name":"end_image","name":"end_image","shape":7,"type":"IMAGE","link":null},{"localized_name":"control_embeds","name":"control_embeds","shape":7,"type":"WANVIDIMAGE_EMBEDS","link":7},{"localized_name":"temporal_mask","name":"temporal_mask","shape":7,"type":"MASK","link":null},{"name":"width","type":"INT","widget":{"name":"width"},"link":12},{"name":"height","type":"INT","widget":{"name":"height"},"link":13},{"name":"num_frames","type":"INT","widget":{"name":"num_frames"},"link":14}],"outputs":[{"localized_name":"image_embeds","name":"image_embeds","type":"WANVIDIMAGE_EMBEDS","links":[4]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"WanVideoImageToVideoEncode"},"widgets_values":[832,480,81,0,1,1,true,false]},{"id":12,"type":"DWPreprocessor","pos":[-4688.298828125,1439.718994140625],"size":[315,222],"flags":{},"order":12,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"IMAGE","link":27}],"outputs":[{"localized_name":"画像","name":"IMAGE","type":"IMAGE","links":[10,11,28]},{"localized_name":"POSE_KEYPOINT","name":"POSE_KEYPOINT","type":"POSE_KEYPOINT","links":null}],"properties":{"cnr_id":"comfyui_controlnet_aux","ver":"83463c2e4b04e729268e57f638b4212e0da4badc","Node name for S&R":"DWPreprocessor"},"widgets_values":["enable","enable","enable",512,"yolox_l.onnx","dw-ll_ucoco_384_bs5.torchscript.pt","disable"]},{"id":22,"type":"VHS_VideoCombine","pos":[-4690.46923828125,1753.2210693359375],"size":[219.3603515625,238],"flags":{},"order":15,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":28},{"localized_name":"audio","name":"audio","shape":7,"type":"AUDIO","link":null},{"localized_name":"meta_batch","name":"meta_batch","shape":7,"type":"VHS_BatchManager","link":null},{"localized_name":"vae","name":"vae","shape":7,"type":"VAE","link":null}],"outputs":[{"localized_name":"Filenames","name":"Filenames","type":"VHS_FILENAMES","links":null}],"properties":{"cnr_id":"comfyui-videohelpersuite","ver":"1.5.14","Node name for S&R":"VHS_VideoCombine"},"widgets_values":{"frame_rate":8,"loop_count":0,"filename_prefix":"AnimateDiff","format":"image/gif","pingpong":false,"save_output":true,"videopreview":{"hidden":false,"paused":false,"params":{"filename":"AnimateDiff_00024.gif","subfolder":"","type":"output","format":"image/gif","frame_rate":8,"workflow":"AnimateDiff_00024.png","fullpath":"/workspace/til/software-engineering/comfyui/_src/kijai-wanvideo/ComfyUI/output/AnimateDiff_00024.gif"}}}},{"id":7,"type":"LoadImage","pos":[-5350.99462890625,498.290283203125],"size":[307.9949951171875,510.27435302734375],"flags":{},"order":6,"mode":0,"inputs":[],"outputs":[{"localized_name":"画像","name":"IMAGE","type":"IMAGE","links":[6,22]},{"localized_name":"マスク","name":"MASK","type":"MASK","links":null}],"properties":{"cnr_id":"comfy-core","ver":"0.3.27","Node name for S&R":"LoadImage"},"widgets_values":["asagi-chan-arms-folded.png","image"]},{"id":13,"type":"VHS_LoadVideo","pos":[-5004.69189453125,279.3496398925781],"size":[252.056640625,736.1005859375],"flags":{},"order":7,"mode":0,"inputs":[{"localized_name":"meta_batch","name":"meta_batch","shape":7,"type":"VHS_BatchManager","link":null},{"localized_name":"vae","name":"vae","shape":7,"type":"VAE","link":null}],"outputs":[{"localized_name":"画像","name":"IMAGE","type":"IMAGE","links":[26]},{"localized_name":"frame_count","name":"frame_count","type":"INT","links":null},{"localized_name":"audio","name":"audio","type":"AUDIO","links":null},{"localized_name":"video_info","name":"video_info","type":"VHS_VIDEOINFO","links":null}],"properties":{"cnr_id":"comfyui-videohelpersuite","ver":"1.5.14","Node name for S&R":"VHS_LoadVideo"},"widgets_values":{"video":"hiroaki-folding-arms-to-dancing.mp4","force_rate":24,"custom_width":0,"custom_height":0,"frame_load_cap":81,"skip_first_frames":0,"select_every_nth":1,"format":"AnimateDiff","choose video to upload":"image","videopreview":{"hidden":false,"paused":false,"params":{"filename":"hiroaki-folding-arms-to-dancing.mp4","type":"input","format":"video/mp4","force_rate":24,"custom_width":0,"custom_height":0,"frame_load_cap":81,"skip_first_frames":0,"select_every_nth":1}}}},{"id":14,"type":"WanVideoDecode","pos":[-2465.021484375,944.3042602539062],"size":[315,174],"flags":{},"order":19,"mode":0,"inputs":[{"localized_name":"vae","name":"vae","type":"WANVAE","link":17},{"localized_name":"samples","name":"samples","type":"LATENT","link":16}],"outputs":[{"localized_name":"images","name":"images","type":"IMAGE","links":[18,33]}],"properties":{"cnr_id":"ComfyUI-WanVideoWrapper","ver":"ce6522c2279c30ed6ac157cbfacd8e15cb1cfae2","Node name for S&R":"WanVideoDecode"},"widgets_values":[false,272,272,144,128]},{"id":24,"type":"ImageConcatMulti","pos":[-4440.93017578125,56.33872604370117],"size":[315,170],"flags":{},"order":21,"mode":0,"inputs":[{"localized_name":"image_1","name":"image_1","type":"IMAGE","link":35},{"localized_name":"image_2","name":"image_2","type":"IMAGE","link":36},{"name":"image_3","type":"IMAGE","link":33}],"outputs":[{"localized_name":"images","name":"images","type":"IMAGE","links":[34]}],"properties":{"cnr_id":"comfyui-kjnodes","ver":"1.0.8"},"widgets_values":[3,"right",true,null]},{"id":19,"type":"ImageResizeKJ","pos":[-5344.72314453125,1069.557373046875],"size":[210,266],"flags":{},"order":9,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"IMAGE","link":22},{"localized_name":"get_image_size","name":"get_image_size","shape":7,"type":"IMAGE","link":null},{"name":"width_input","shape":7,"type":"INT","widget":{"name":"width_input"},"link":null},{"name":"height_input","shape":7,"type":"INT","widget":{"name":"height_input"},"link":null}],"outputs":[{"localized_name":"画像","name":"IMAGE","type":"IMAGE","links":[23,35]},{"localized_name":"width","name":"width","type":"INT","links":[24]},{"localized_name":"height","name":"height","type":"INT","links":[25]}],"properties":{"cnr_id":"comfyui-kjnodes","ver":"1.0.8","Node name for S&R":"ImageResizeKJ"},"widgets_values":[480,832,"nearest-exact",false,2,0,0,"disabled"]},{"id":20,"type":"ImageResizeKJ","pos":[-4996.6201171875,1067.4715576171875],"size":[210,266],"flags":{},"order":11,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"IMAGE","link":26},{"localized_name":"get_image_size","name":"get_image_size","shape":7,"type":"IMAGE","link":null},{"name":"width_input","shape":7,"type":"INT","widget":{"name":"width_input"},"link":null},{"name":"height_input","shape":7,"type":"INT","widget":{"name":"height_input"},"link":null},{"name":"width","type":"INT","widget":{"name":"width"},"link":24},{"name":"height","type":"INT","widget":{"name":"height"},"link":25}],"outputs":[{"localized_name":"画像","name":"IMAGE","type":"IMAGE","links":[27,36]},{"localized_name":"width","name":"width","type":"INT","links":null},{"localized_name":"height","name":"height","type":"INT","links":null}],"properties":{"cnr_id":"comfyui-kjnodes","ver":"1.0.8","Node name for S&R":"ImageResizeKJ"},"widgets_values":[512,512,"nearest-exact",false,2,0,0,"disabled"]},{"id":15,"type":"VHS_VideoCombine","pos":[-4709.67724609375,283.93634033203125],"size":[219.3603515625,666.650634765625],"flags":{},"order":20,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":18},{"localized_name":"audio","name":"audio","shape":7,"type":"AUDIO","link":null},{"localized_name":"meta_batch","name":"meta_batch","shape":7,"type":"VHS_BatchManager","link":null},{"localized_name":"vae","name":"vae","shape":7,"type":"VAE","link":null}],"outputs":[{"localized_name":"Filenames","name":"Filenames","type":"VHS_FILENAMES","links":null}],"properties":{"cnr_id":"comfyui-videohelpersuite","ver":"1.5.14","Node name for S&R":"VHS_VideoCombine"},"widgets_values":{"frame_rate":24,"loop_count":0,"filename_prefix":"WanVideoWrapper_I2V","format":"video/h265-mp4","pix_fmt":"yuv420p10le","crf":22,"save_metadata":true,"pingpong":false,"save_output":true,"videopreview":{"hidden":false,"paused":false,"params":{"filename":"AnimateDiff_00031.mp4","subfolder":"","type":"output","format":"video/h265-mp4","frame_rate":24,"workflow":"AnimateDiff_00031.png","fullpath":"/workspace/til/software-engineering/comfyui/_src/kijai-wanvideo/ComfyUI/output/AnimateDiff_00031.mp4"}}}},{"id":25,"type":"VHS_VideoCombine","pos":[-4438.619140625,282.5776672363281],"size":[219.3603515625,438.8669128417969],"flags":{},"order":22,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":34},{"localized_name":"audio","name":"audio","shape":7,"type":"AUDIO","link":null},{"localized_name":"meta_batch","name":"meta_batch","shape":7,"type":"VHS_BatchManager","link":null},{"localized_name":"vae","name":"vae","shape":7,"type":"VAE","link":null}],"outputs":[{"localized_name":"Filenames","name":"Filenames","type":"VHS_FILENAMES","links":null}],"properties":{"cnr_id":"comfyui-videohelpersuite","ver":"1.5.14","Node name for S&R":"VHS_VideoCombine"},"widgets_values":{"frame_rate":24,"loop_count":0,"filename_prefix":"WanVideoWrapper_I2V","format":"video/h265-mp4","pix_fmt":"yuv420p10le","crf":22,"save_metadata":true,"pingpong":false,"save_output":true,"videopreview":{"hidden":false,"paused":false,"params":{"filename":"AnimateDiff_00032.mp4","subfolder":"","type":"output","format":"video/h265-mp4","frame_rate":24,"workflow":"AnimateDiff_00032.png","fullpath":"/workspace/til/software-engineering/comfyui/_src/kijai-wanvideo/ComfyUI/output/AnimateDiff_00032.mp4"}}}}],"links":[[1,2,0,1,0,"WANVIDEOMODEL"],[2,3,0,1,1,"WANVIDEOTEXTEMBEDS"],[3,4,0,3,0,"WANTEXTENCODER"],[4,5,0,1,2,"WANVIDIMAGE_EMBEDS"],[5,6,0,5,0,"WANVAE"],[6,7,0,5,2,"IMAGE"],[7,8,0,5,4,"WANVIDIMAGE_EMBEDS"],[8,9,0,8,0,"LATENT"],[9,6,0,9,0,"WANVAE"],[10,12,0,9,1,"IMAGE"],[11,12,0,11,0,"IMAGE"],[12,11,1,5,6,"INT"],[13,11,2,5,7,"INT"],[14,11,3,5,8,"INT"],[16,1,0,14,1,"LATENT"],[17,6,0,14,0,"WANVAE"],[18,14,0,15,0,"IMAGE"],[19,16,0,5,1,"WANVIDIMAGE_CLIPEMBEDS"],[20,17,0,16,0,"CLIP_VISION"],[22,7,0,19,0,"IMAGE"],[23,19,0,16,1,"IMAGE"],[24,19,1,20,4,"INT"],[25,19,2,20,5,"INT"],[26,13,0,20,0,"IMAGE"],[27,20,0,12,0,"IMAGE"],[28,12,0,22,0,"IMAGE"],[33,14,0,24,2,"IMAGE"],[34,24,0,25,0,"IMAGE"],[35,19,0,24,0,"IMAGE"],[36,20,0,24,1,"IMAGE"]],"groups":[],"config":{},"extra":{"ds":{"scale":1.3109994191500303,"offset":[4984.898252738165,-244.06608449629226]},"VHS_latentpreview":false,"VHS_latentpreviewrate":0,"VHS_MetadataImage":true,"VHS_KeepIntermediate":true},"version":0.4}