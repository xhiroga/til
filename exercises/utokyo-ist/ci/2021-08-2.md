# 2022年度 創造情報学 第2問

幾何分布、スループット計算、TCPウインドウ制御の理解が問われる問題。

通信速度の解析については[IoT通信性能解析](https://amzn.to/3Af1fpZ)が試験の範囲を越えて非常に詳しい。

## (1)

問題文における遅延だが、**何種類かの解釈があり得る。**

1. RTT (ラウンドトリップタイム)
2. 片側遅延 (RTTの半分)
3. プロセス遅延（出力先インターフェース決定、ヘッダ書き換えなど）

出題の意図が帯域遅延積の計算であると思われることから、計算しやすいRTTと解釈して進める。

クライアントノードがパケットの転送を開始しサーバーノードからの対応するACKパケットを受け取るまでの時間は次の通りと思われる。

$$
\begin{align}
& 0.1 + D_2 + 0.1 \\
=& 0.2 + D_2
\end{align}
$$

また、確率は次の通り。

$$
\begin{align}
a^{n-1} (1-a)
\end{align}
$$

## (2)

### 平均転送速度

あえて平均転送速度と最大転送速度を分けて書いているので、文脈的にビット誤りを考慮してほしいものと推察する。ビット誤りのないデータ転送にかかる回数の期待値を求める。これは、成功か失敗かの試行（ベルヌーイ試行）が初めて成功するまでの確率分布（幾何分布）である。よって、期待値は次の通り。

$$
\begin{align}
E &= \frac{1}{1-a} \\
\end{align}
$$

データの平均転送速度を求める。ここでも2通りの解釈で迷った。

1. クライアントからサーバーに送信するファイルのパケットの転送速度
2. ACKパケットまで含めた往復の転送速度

問題文に「クライアントからサーバーノードへのデータの平均転送速度」とあるので、1つ目の解釈を取る。式は次の通り。

$$
\begin{align}
\frac{1}{1-a}\cdot\frac{m_1}{0.2 + D_2}
\end{align}
$$

### 最大転送速度

与えられた数値に基づいて計算を行う。

$D_2=0.1\text{msec}, B_2=1\text{Gbits/sec}$の場合、最大転送速度は次の通り。

$$
\begin{align}
& \frac{100}{0.3} \text{bits/msec} \\
\approx& 333 \text{ Kbits/sec} \\
\end{align}
$$

$D_2=500\text{msec}, B_2=10\text{Mbits/sec}$の場合、最大転送速度は次の通り。

$$
\begin{align}
& \frac{100}{500.2} \text{bits/msec} \\
\approx& 200\text{ bits/sec} \\
\end{align}
$$

## (3)

ウインドウサイズと帯域遅延積（ネットワークパイプの容量）を比較する。

初めに、ウインドウサイズを$bits$に直す。

$$
\begin{align}
& 64\text{Kbytes} \\
=& 64 * 10^3 * 8 \\
=& 512000\text{bits}
\end{align}
$$

次に、帯域遅延積を求める。帯域遅延積の計算式は次の通り。

$$
B_{min} * (D_1 + D_2 + D_3)
$$

$D_2=0.1\text{msec}, B_2=1\text{Gbits/sec}$の場合の帯域遅延積は次の通り。

$$
\begin{align}
& (1\text{Gbits/sec} = 1\text{Mbits/msec}) * 0.3\text{msec} \\
=& 300000\text{bits}
\end{align}
$$

この場合、帯域遅延積はウィンドウサイズよりも小さい。つまり、ウィンドウサイズの上限に達するまでに最初のACKが返ってくる。よって、帯域幅がそのまま最大の転送速度である。

$D_2=500\text{msec}, B_2=10\text{Mbits/sec}$の場合の帯域遅延積は次の通り。

$$
\begin{align}
& (10\text{Mbits/sec} = 10\text{Kbits/msec}) * 500.2\text{msec}\\
=& 5002000\text{bits}
\end{align}
$$

この場合、帯域遅延積はウィンドウサイズよりも大きい。つまり、パイプは空いているのにACKが返ってこないため、ウィンドウサイズまで送信したらしばらく待つことになる。よって、次の通り最大の転送速度を求める。

$$
\begin{align}
& \frac{512000}{500.2} \\
\approx& 102\text{Kbits/sec}
\end{align}
$$

## (4)

クライアントはパケットを一定のレートで送信する。初め、ACKパケットはRTTの通りに返ってくるはずである。クライアントが徐々に送信レートを引き上げると、ネットワークのボトルネックの帯域幅に到達した時点でACKの間隔に変化が訪れる。そのようにして得たRTTと帯域幅から帯域遅延積を求め、(4)のようにウィンドウサイズと比較して最大転送速度を予測する。

## (5)

$$
\begin{align}
\frac{512000}{0.2+D_2} &\ge 8\text{Mbits/sec} \\
\frac{0.2+D_2}{512000} &\le \frac{1}{8000} \\
0.2+D_2 &\le \frac{512000}{8000} \\
D_2 &\le 64 - 0.2 \\
D_2 &\le 63.8 \\
\end{align}
$$

## (6)

1. TCPではなくUDPを用いる。
2. 複数のTCPパイプを利用する。
