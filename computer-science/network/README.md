# ネットワーク (network)

## 基礎知識

## データリンク

## IP

ネットワーク層とデータリンク層の関係は、旅行代理店の比喩が分かりやすい。旅行者が旅行代理店に行き先を伝えると、旅行代理店が現地までの電車や飛行機などを手配してくれる、というものである。旅行代理店の場合は、事前に経路が分かっている。しかし、実際のネットワーク通信では、ノードはどのルーターを通るかを事前に調べているのだろうか？

実際のネットワーク通信では、事前に経由するルーターを全て把握する必要はなく（仮にそうだとしたら、ISPがルーターの交換作業をする度にネットワークの再接続が起きそうじゃないですか？）、パケットを受け取ったノードそれぞれが、隣り合うノードの中で宛先のIPアドレスに最も近いノードにパケットを送ることを繰り返している。といっても、IPアドレスは$2^{32} = 4294967296$種類もある。1エントリあたり僅か16バイト[^16byte]で見積もっても64GB必要になってしまうし、そもそも経路情報の交換が頻繁に発生しすぎて通信どころではないのではないか。

[^16byte]: IPアドレス4バイト、ネクストホップ4バイト、その他8バイトで計算。

そこで、IPアドレスをひとかたまりにして管理し、かつルーターの経路情報にはかたまりの単位でネクストホップを記録しよう、という発想になる。当初IPアドレスはA,B,C,D,Eの5クラスに分類されており、クラスごとにネットワーク部とホスト部が分けられていた。しかし、クラスAやBのアドレスが効率的に使われないことから、柔軟にネットワーク部とホスト部を分ける必要が出てきた。

<!-- クラスAアドレスって誰が使う予定だったんだろう？現在の常識から考えると、政府機関などでも流石に1600万近いアドレスを1箇所で使えないと思うんだけど... -->

サブネットマスクは、経路制御の表において、複数のIPアドレスを自由に束ねることができる。ネットワーク部とホスト部を分けているんだから単にマスクもしくはネットマスクで良いのでは？というのは良い視点で、Aクラスを`/24`でマスクするなど既存のクラスの下位のマスクが可能だからサブネットマスクと呼ばれているそうだ。[^milestone-of-se_subnet]

[^milestone-of-se_subnet]: [【図解】初心者にも分かるサブネットマスクとデフォルトゲートウェイ](https://milestone-of-se.nesuke.com/nw-basic/ip/subnet-mask-and-default-gateway/)

<!-- ルーティングの工夫 -->

### IPv4

IPv4アドレスは、IP通信を行うノードを識別するためのIDである。NICに割り当てるため、例えばEthernetとWiFiの2つのインターフェースを持つマザーボードのマシンは、2つのIPアドレスを持つ。また、ルーターには2つ以上のNICを持つため、2つ以上のIPアドレスを持つ。


<!-- サブネットマスクの歴史 -->

<!-- https://milestone-of-se.nesuke.com/nw-basic/ip/subnet-mask-and-default-gateway/ -->

<!-- 1人1つIPアドレスを持っていた日本の会社の話 -->

<!-- > [!NOTE] キリ番のIPアドレスってどうやって取得してるの？ -->

### IPv6

<!-- > [!NOTE] IPv4は繋がらないのにIPv6は繋がる事象ってなぜ起きるの？ -->

<!-- https://x.com/xhiroga/status/1731655265290981481 -->

<!-- > [!NOTE] IPアドレスの開示請求とIPv6って関係ある？ -->

## TCP, UDP

## ルーティングプロトコル

<!-- > [!NOTE] BGPを自分で取得するには？ -->

## アプリケーションプロトコル

## References

[マスタリングTCP/IP](https://amzn.to/3x7Mq7z)
