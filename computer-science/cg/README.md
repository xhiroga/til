# CG (computer graphics)

## 基礎知識

> [!NOTE] ビットマップ画像とラスタ画像って同じ？
> 同じ意味で使われるが、厳密には異なる。ラスターはラテン語で引っ掻くを意味する rodere に由来し、同じ語源を持つ言葉としては rake (熊手) や rodent (げっ歯類) がある。
> 画像を平行な線の集合と捉えてスキャンすることをラスタースキャンという。FAXの送受信はラスタースキャンを用いている。そのように表現された画像をラスタ画像と呼ぶ。
> ビットマップ画像はラスター画像をコンピューターで扱うための仕様といえる。元々は、フォントを画面上に表示する際のビットの割当表をビットマップと呼んだそうだ。

## 座標変換とパイプライン

### 3次元座標系

X,Y,Zの3軸を考えたとき、Z軸を奥から手前向きに、Y軸を下から上向きに固定した際、X軸が右向き（右手系）か左向き（左手系）かの違い。または、X軸を右向きに固定した際、Y軸が上向き（右手系）か下向き（左手系）かの違い。言い換えると、座標(0,0)が左下（右手系）か左下（左手系）かの違い。

学校の数学では座標(0,0)が左下なのに対して、テレビでは座標(0,0)が左上だったことが違いを生んでいると言われている。[^stackoverflow_2011]
[^stackoverflow_2011]: [Historic reasons for Left-Handed Coordinate System](https://stackoverflow.com/questions/6698817/historic-reasons-for-left-handed-coordinate-system)

### シェーダー

2000年前後、グラフィックボードの進化に伴いCPUの処理がボトルネックとなり、オブジェクトの座標変換と照明 (Transform&Lightning)もグラフィックボードが担当するようになった。Direct7では予め用意されたシェーダーを利用するのみだったが、Direct8からはプログラミング可能なシェーダーが登場し、現在ではこれを単にシェーダーと呼ぶ。

## モデリング

### プロシージャルモデリング

炎・煙・水しぶきなど、時間によって形が変わるもの、大量にあってポリゴンでモデリングすると手間ひまがかかるものを、数式で表現すること。

## レンダリング

### フォトリアリスティックレンダリング

### 隠面消去

3Dオブジェクトを描画する際、手前の面だけが見えるようにすること。凸面だけのオブジェクト単体を考えるなら、こちらを向いている面だけを描画すればよい。具体的には、法線と視点のベクトルの内積を取り、その値が正なら描画する。

奥のオブジェクトから順番に描画し、重なった箇所は手前のオブジェクトで塗りつぶすアルゴリズムを優先順位アルゴリズム、またはペインタアルゴリズムと呼ぶ。予めオブジェクトを奥行き順にソートする必要がある。オブジェクトが3すくみの場合には、オブジェクト単位で優先順位を付けることができないため、ポリゴンを2つに切断する。ペインタアルゴリズムは見えないオブジェクトまで描画するため効率が悪い。したがって、手前から順に描画する逆ペインタアルゴリズムも存在する。

スクリーンを1行ごとに描画する手法として、スキャンライン法がある。[^try3dcg_render]オブジェクトの重なり合いの判定を1行毎に行うため、アルゴリズムはやや複雑であり、かつ時間がかかる。しかし、1行毎にディスプレイに反映してしまって構わないため、メモリの少ない環境でも採用できる。[^oshita_2019]
[^try3dcg_render]: [【はじめての3DCG】：スキャンライン](https://www.asahi-net.or.jp/~qb3k-kwsk/3dcg/know/render/render11.html)
[^oshita_2019]: [コンピューターグラフィックスＳ](http://www.ha.ai.kyutech.ac.jp/lecture/cg/cg05_rendering_s.pdf)

ペインタアルゴリズムはポリゴンの分割やオブジェクトのソートが必須であり、アルゴリズムがやや複雑となり、おそらく並列計算との相性も悪い。そこで、全てのオブジェクトのピクセルについて、そのピクセルが暫定的に最も手前であった場合にバッファの色を更新するようなアルゴリズムがあり、これをZバッファ法と呼ぶ。GPUのサポートがあることから、広く利用されている。

スキャンライン法では、オブジェクトの重なり合いの判定を行の区間ごとに行った。ピクセル単位で行うのがレイトレーシング法である。

### 隠線消去

### シェーディング

### 影付け（シャドウイング）

### マッピング

3Dオブジェクトに模様や画像を貼り付けて表示することをテクスチャマッピングと呼ぶ。プロジェクションマッピングの要領でテクスチャを表示することを投影テクスチャマッピング、または単に投影マッピングと呼ぶ。プロジェクターの前を歩いても画像が人に着いてこないように、テクスチャはオブジェクトの動きに追随しない。オブジェクトに模様を追随させるには、座標を用いたマッピングが行われる。

模様の貼付けではなく凹凸をマッピングする手法をバンプマッピングと呼ぶ。エッチング加工のような手法と言えそうだ。

反射による周囲の映り込みをマッピングにより擬似的に再現する方法を環境マッピングと呼ぶ。スーパーマリオ64でメタルマリオに花の写真をマッピングしていた手法ではないか。[^n64_2022]
[^n64_2022]: [Here is the texture for the Metal Mario reflection on Mario64](https://www.reddit.com/r/n64/comments/svgtwm/here_is_the_texture_for_the_metal_mario/)

テクスチャを3次元空間の模様として表現することをソリッドマッピングと呼ぶ。角や断面においてもマッピングが自然になる効果がある。

### 大域照明計算 (global illumination calculation)

太陽などの光源からの直射光のみを考慮する考え方を局所証明と呼ぶのに対して、間接光まで考慮することを大域照明 (global illumination)と呼ぶ。大域照明のレンダリング方程式は、次の通り大別される。

- ラジオシティ法
- モンテカルロ法
- マルコフ連鎖モンテカルロ法

ラジオシティ法では、物体を小さなパッチに分割し、それぞれのパッチの単位面積あたりの放射を未知数とした方程式を解くことで明るさを求める。[^nishita_2014]シーン内の物体の形状が変わらなければ、カメラの位置が変わっても明るさを再計算しないで良い点がメリットである。
[^nishita_2014]: [Radiosity Method](http://nishitalab.org/user/nis/ourworks/radiosity/radiosity.html)

モンテカルロ法を用いる手法として、パストレーシング (経路追跡法, path tracing) がある。カメラに写っている面と光源の間の光の経路を計算し、光源まで運よくたどり着けば寄与を計算する。この際、モンテカルロ積分を用いて各経路の寄与を平均化し、最終的なピクセルの輝度を求める。この手法は多くの経路を追跡し、その結果を平均化することでリアルな画像を生成することができる。

同じくモンテカルロ法を用いる手法として、フォトンマッピングがある。光源からと視線からの2つのレイトレーシングを行ったうえで、それらの経路が近くにあるときは結んで1つの経路とみなす。

## グラフィックス

### 可視化

MRIで撮影したデータなどの3次元のボリュームデータを可視化する技法として、ボリュームレンダリングがあり、その代表的な手法にレイキャスティングがある。物体の表面かどうかにかかわらず視線からのレイが通った経路を取得し、その経路上のボリュームには不透明度を設置することで、3次元のオブジェクトが透けている状態で観測ができる。

## アニメーション

## References

[コンピュータグラフィックス](https://amzn.to/3xirgU8)
